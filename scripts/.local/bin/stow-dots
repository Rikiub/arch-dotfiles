#/usr/bin/env sh

DOTFILES_DIR="$HOME/dotfiles"
GIT_DIR="--work-tree=$DOTFILES_DIR"

INSTALL_DOTS="default scripts fish sway-rice i3"

function sync {
	echo "> Searching and fixing broken symlinks..."
	find ~/.config -xtype l -delete
	find ~/.local -xtype l -delete

	echo "> Syncing..."
	stow --dotfiles --dir="$DOTFILES_DIR" --target="$HOME" \
	$INSTALL_DOTS

	# check if stow return error
	if [ $? -ne 0 ]; then
		echo "ERROR: Stow threw a error"
		exit 1
	fi

	echo "> Completed dotfiles sync"
}

function push {
	echo "> Starting git"

	# push to my github account
	git $GIT_DIR add .
	git $GIT_DIR commit -m "update"
	git $GIT_DIR push

	# check if git return error
	if [ $? -ne 0 ]; then
		echo "ERROR: Git threw a error"
		exit 1
	fi

	echo "> Completed dotfiles push"
}

case "$1" in
	sync)
		sync
		;;
	push)
		push
		;;
	both)
		sync
		push
		;;
	*)
		echo "ERROR: Arguments not provided"
		exit 1
		;;
esac
