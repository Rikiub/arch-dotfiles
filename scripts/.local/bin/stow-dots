#!/usr/bin/env sh

# Specified the dotfiles to install here
DEFAULT_DOTS="default shell arch-linux i3 pywal wayland-de"
FOLDER_DOTS="scripts"

DOTFILES_DIR="$HOME/dotfiles"
GIT_DIR="--git-dir=$DOTFILES_DIR/.git --work-tree=$DOTFILES_DIR"
STOW_DIR="--dotfiles --dir=$DOTFILES_DIR --target=$HOME"

function show_usage {
	echo "Usage: stow-dots [sync|push|both] [list]"
}

function sync {
	echo "> Searching and fixing broken symlinks..."
	find ${XDG_CONFIG_HOME:-$HOME/.config} -xtype l -delete
	find ${XDG_DATA_HOME:-$HOME/.local/share} -xtype l -delete

	echo "> Syncing..."
	stow $STOW_DIR \
	$DEFAULT_DOTS

	stow $STOW_DIR --no-folding \
	$FOLDER_DOTS

	# check if stow return error
	if [ $? -ne 0 ]; then
		echo "ERROR: Stow threw a error"
		exit 1
	fi

	echo "> Completed dotfiles sync"
}

function push {
	echo "> Starting git"

	# push to my github account
	git $GIT_DIR add .
	git $GIT_DIR commit -m "update"
	git $GIT_DIR push

	# check if git return error
	if [ $? -ne 0 ]; then
		echo "ERROR: Git threw a error"
		exit 1
	fi

	echo "> Completed dotfiles push"
}

function list {
	ls $DOTFILES_DIR --group-directories-first --color
}

# main
case "$1" in
	--help|-h)
		show_usage
		;;
	sync)
		sync
		;;
	push)
		push
		;;
	both)
		sync
		echo ''
		push
		;;
	list|-l)
		list
		;;
	*)
		echo "ERROR: Arguments not provided"
		echo ''
		show_usage
		exit 1
		;;
esac
